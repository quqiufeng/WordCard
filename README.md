# WordCard Translator

英文文章自动翻译工具，生成中英双语学习材料。

## 功能特点

- **全文翻译**：使用 NLLB-200 模型将英文翻译成中文
- **词汇提取**：自动从文章提取长度>=6的有价值词汇（过滤常用词）
- **句子提取**：提取包含关键词的精彩句子（80-250字符）
- **双语对照**：生成 EN-CH 双语区块，英文中文逐段对照
- **格式美观**：中英文宽度对齐，段落清晰

## 安装依赖

```bash
pip install ctransformers transformers tqdm torch
```

**模型要求**：
- 需要下载 NLLB-200 3.3B 模型（FP16格式）
- 模型路径：`E:/cuda/nllb-200-3.3B-ct2-float16`
- 支持 CUDA GPU 加速

## 使用方法

```bash
python translate.py article.txt
```

## 配置说明

脚本顶部可配置参数：

```python
MODEL_DIR = "E:/cuda/nllb-200-3.3B-ct2-float16"  # 模型路径

EN_WRAP = 65  # 英文每行字符数（与中文40字符宽度对齐）
ZH_WRAP = 40  # 中文每行字符数
```

## 技术架构

### 核心模块

```
translate.py
├── load_translator()      # 加载 NLLB 翻译模型
├── load_article()         # 读取原始文章，解析段落
├── translate_text()       # 翻译单个文本
├── translate_batch()      # 批量翻译（带进度条）
├── wrap_english()          # 英文按字符数换行（单词边界断行）
├── wrap_chinese()         # 中文按字符数换行
├── extract_vocabulary()    # 提取文章词汇（过滤常用词）
├── extract_sentences()     # 提取精彩句子
└── create_trans_file()     # 生成输出文件
```

### 处理流程

```
输入文件 (article.txt)
    │
    ▼
┌─────────────────┐
│ 1. 读取文章      │  解析标题、段落
└────────┬────────┘
         ▼
┌─────────────────┐
│ 2. 翻译全文      │  NLLB-200 模型翻译
└────────┬────────┘
         ▼
┌─────────────────┐
│ 3. 提取词汇      │  长度>=6，过滤常用词
└────────┬────────┘
         ▼
┌─────────────────┐
│ 4. 翻译词汇      │  逐词翻译
└────────┬────────┘
         ▼
┌─────────────────┐
│ 5. 提取句子      │  80-250字符，关键词筛选
└────────┬────────┘
         ▼
┌─────────────────┐
│ 6. 翻译句子      │  逐句翻译
└────────┬────────┘
         ▼
┌─────────────────┐
│ 7. 生成输出      │  格式化为 _trans.txt
└─────────────────┘
```

### 关键技术

- **翻译模型**：Meta NLLB-200 (No Language Left Behind)
  - 支持200种语言
  - CTranslate2 量化加速
  - CUDA GPU 推理

- **词汇提取**：
  - 正则匹配提取单词
  - 停用词表过滤（约120个常用词）
  - 按长度降序排序

- **句子提取**：
  - 句末标点分割句子
  - 长度范围筛选（80-250字符）
  - 关键词匹配

- **文本换行**：
  - 英文：按字符数，在单词边界断行
  - 中文：按字符数截断
  - 中英文宽度对齐（65字符 ≈ 40汉字）

## 输出格式

```txt
TITLE: 文章标题

ORIGINAL:
英文原文（按65字符换行）

---

EN-CH:
中英双语：
[段落1]
英文...
中文...
[段落2]
英文...
中文...

---

VOCABULARY:
1. vocabulary|n.|词汇
2. ...
3. ...

---

SENTENCES:
1. English sentence.|中文翻译。
2. ...
```

## 文件说明

| 文件 | 说明 |
|------|------|
| `translate.py` | 主翻译脚本 |
| `article_card.py` | 卡片生成脚本（PNG/PDF/MD） |
| `solar_system.txt` | 示例英文文章 |
| `solar_system_trans.txt` | 翻译后的双语文件 |
| `output/` | 生成的卡片文件目录 |

## 运行环境

- Python 3.8+
- CUDA 11.x + cuDNN 8.x
- 8GB+ GPU 显存
- Windows/Linux
